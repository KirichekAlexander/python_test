name: Build Linux wheel (cp35)

on:
  workflow_dispatch:
  push:

jobs:
  linux_cp35:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build wheel (cp35) in manylinux1
        run: |
          docker run --rm -v "${{ github.workspace }}:/io" quay.io/pypa/manylinux1_x86_64 bash -lc '
            set -eux
            ls -la /opt/python

            PY=/opt/python/cp35-cp35m/bin/python
            PIP=/opt/python/cp35-cp35m/bin/pip

            $PY -V

            $PIP install -U "pip<21" "setuptools<51.3" "wheel" "pybind11==2.9.0"
            /opt/python/cp36-cp36m/bin/pip install -U "pip<21" "auditwheel<3.3"

            cd /io
            $PY setup.py bdist_wheel

            mkdir -p /io/wheelhouse
            /opt/python/cp36-cp36m/bin/auditwheel repair dist/*.whl -w /io/wheelhouse
          '

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: linux-cp35-wheel
          path: wheelhouse/*.whl
